<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="1. å…³äº å †å’Œæ ˆæ ˆå¯ä»¥ç®€å•å¾—ç†è§£æˆä¸€æ¬¡å‡½æ•°è°ƒç”¨å†…éƒ¨ç”³è¯·åˆ°çš„å†…å­˜ï¼Œå®ƒä»¬ä¼šéšç€å‡½æ•°çš„è¿”å›æŠŠå†…å­˜è¿˜ç»™ç³»ç»Ÿã€‚ 1234func F() &#123;    temp :&#x3D; make([]int, 0, 20)    ...&#125; ç±»ä¼¼äºä¸Šé¢ä»£ç é‡Œé¢çš„tempå˜é‡ï¼Œåªæ˜¯å†…å‡½æ•°å†…éƒ¨ç”³è¯·çš„ä¸´æ—¶å˜é‡ï¼Œå¹¶ä¸ä¼šä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå®ƒå°±æ˜¯è¢«ç¼–è¯‘å™¨ç”³è¯·åˆ°æ ˆé‡Œé¢ã€‚  ç”³è¯·åˆ°æ ˆå†…å­˜å¥½å¤„ï¼šå‡½æ•°è¿”å›ç›´æ¥é‡Šæ”¾ï¼Œä¸ä¼šå¼•èµ·åƒåœ¾å›æ”¶">
<meta property="og:type" content="article">
<meta property="og:title" content="Goå†…å­˜é€ƒé€¸åˆ†æ">
<meta property="og:url" content="http://example.com/2021/02/03/technology/golang/memory_escape/index.html">
<meta property="og:site_name" content="zhyyao">
<meta property="og:description" content="1. å…³äº å †å’Œæ ˆæ ˆå¯ä»¥ç®€å•å¾—ç†è§£æˆä¸€æ¬¡å‡½æ•°è°ƒç”¨å†…éƒ¨ç”³è¯·åˆ°çš„å†…å­˜ï¼Œå®ƒä»¬ä¼šéšç€å‡½æ•°çš„è¿”å›æŠŠå†…å­˜è¿˜ç»™ç³»ç»Ÿã€‚ 1234func F() &#123;    temp :&#x3D; make([]int, 0, 20)    ...&#125; ç±»ä¼¼äºä¸Šé¢ä»£ç é‡Œé¢çš„tempå˜é‡ï¼Œåªæ˜¯å†…å‡½æ•°å†…éƒ¨ç”³è¯·çš„ä¸´æ—¶å˜é‡ï¼Œå¹¶ä¸ä¼šä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå®ƒå°±æ˜¯è¢«ç¼–è¯‘å™¨ç”³è¯·åˆ°æ ˆé‡Œé¢ã€‚  ç”³è¯·åˆ°æ ˆå†…å­˜å¥½å¤„ï¼šå‡½æ•°è¿”å›ç›´æ¥é‡Šæ”¾ï¼Œä¸ä¼šå¼•èµ·åƒåœ¾å›æ”¶">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/02/03/technology/golang/memory_escape/img_1.png">
<meta property="og:image" content="http://example.com/2021/02/03/technology/golang/memory_escape/img_2.png">
<meta property="article:published_time" content="2021-02-03T07:51:53.000Z">
<meta property="article:modified_time" content="2025-02-26T04:57:18.659Z">
<meta property="article:author" content="zhyyao">
<meta property="article:tag" content="åº•å±‚åŸç†">
<meta property="article:tag" content="é¢è¯•é¢˜">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/02/03/technology/golang/memory_escape/img_1.png">


<link rel="canonical" href="http://example.com/2021/02/03/technology/golang/memory_escape/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2021/02/03/technology/golang/memory_escape/","path":"2021/02/03/technology/golang/memory_escape/","title":"Goå†…å­˜é€ƒé€¸åˆ†æ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Goå†…å­˜é€ƒé€¸åˆ†æ | zhyyao</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">zhyyao</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">zhyyao-blogs</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-é¦–é¡µ"><a href="/" rel="section"><i class="fas fas fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-åˆ†ç±»"><a href="/categories/" rel="section"><i class="fas fa-folder-open fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-æ—¶é—´è½´"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>æ—¶é—´è½´</a></li><li class="menu-item menu-item-æ ‡ç­¾"><a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-å…³äºæˆ‘"><a href="/about/" rel="section"><i class="fas fa-heart fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E4%BA%8E-%E5%A0%86%E5%92%8C%E6%A0%88"><span class="nav-number">1.</span> <span class="nav-text">1. å…³äº å †å’Œæ ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%EF%BC%88Escape-analysis%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">2. é€ƒé€¸åˆ†æï¼ˆEscape analysisï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%80%83%E9%80%B8%E5%9C%BA%E6%99%AF%EF%BC%88%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E6%89%8D%E5%88%86%E9%85%8D%E5%88%B0%E5%A0%86%E4%B8%AD%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">3. é€ƒé€¸åœºæ™¯ï¼ˆä»€ä¹ˆæƒ…å†µæ‰åˆ†é…åˆ°å †ä¸­ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%8C%87%E9%92%88%E9%80%83%E9%80%B8"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 æŒ‡é’ˆé€ƒé€¸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%A0%88%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3%E9%80%83%E9%80%B8%EF%BC%88%E7%A9%BA%E9%97%B4%E5%BC%80%E8%BE%9F%E8%BF%87%E5%A4%A7%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ï¼ˆç©ºé—´å¼€è¾Ÿè¿‡å¤§ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%8A%A8%E6%80%81%E7%B1%BB%E5%9E%8B%E9%80%83%E9%80%B8%EF%BC%88%E4%B8%8D%E7%A1%AE%E5%AE%9A%E9%95%BF%E5%BA%A6%E5%A4%A7%E5%B0%8F%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 åŠ¨æ€ç±»å‹é€ƒé€¸ï¼ˆä¸ç¡®å®šé•¿åº¦å¤§å°ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E9%97%AD%E5%8C%85%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E9%80%83%E9%80%B8"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2%EF%BC%9F"><span class="nav-number">3.5.</span> <span class="nav-text">é€ƒé€¸åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">3.6.</span> <span class="nav-text">é€ƒé€¸æ€»ç»“ï¼š</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhyyao"
      src="/images/self.jpeg">
  <p class="site-author-name" itemprop="name">zhyyao</p>
  <div class="site-description" itemprop="description">record and sharing learning experiences</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yaoyizhuo" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yaoyizhuo" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yyzclick@126.com" title="E-Mail â†’ mailto:yyzclick@126.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_45804375?spm=1000.2115.3001.5343" title="CSND â†’ https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_45804375?spm&#x3D;1000.2115.3001.5343" rel="noopener me" target="_blank"><i class="fa-solid fa-pen-fancy fa-fw"></i>CSND</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/03/technology/golang/memory_escape/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.jpeg">
      <meta itemprop="name" content="zhyyao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhyyao">
      <meta itemprop="description" content="record and sharing learning experiences">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Goå†…å­˜é€ƒé€¸åˆ†æ | zhyyao">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Goå†…å­˜é€ƒé€¸åˆ†æ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-03 15:51:53" itemprop="dateCreated datePublished" datetime="2021-02-03T15:51:53+08:00">2021-02-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-26 12:57:18" itemprop="dateModified" datetime="2025-02-26T12:57:18+08:00">2025-02-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="1-å…³äº-å †å’Œæ ˆ"><a href="#1-å…³äº-å †å’Œæ ˆ" class="headerlink" title="1. å…³äº å †å’Œæ ˆ"></a>1. å…³äº å †å’Œæ ˆ</h2><p>æ ˆå¯ä»¥ç®€å•å¾—ç†è§£æˆä¸€æ¬¡å‡½æ•°è°ƒç”¨å†…éƒ¨ç”³è¯·åˆ°çš„å†…å­˜ï¼Œå®ƒä»¬ä¼šéšç€å‡½æ•°çš„è¿”å›æŠŠå†…å­˜è¿˜ç»™ç³»ç»Ÿã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span></span> &#123;</span><br><span class="line">    temp := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼äºä¸Šé¢ä»£ç é‡Œé¢çš„tempå˜é‡ï¼Œåªæ˜¯å†…å‡½æ•°å†…éƒ¨ç”³è¯·çš„ä¸´æ—¶å˜é‡ï¼Œå¹¶ä¸ä¼šä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå®ƒå°±æ˜¯è¢«ç¼–è¯‘å™¨ç”³è¯·åˆ°æ ˆé‡Œé¢ã€‚ </p>
<p>ç”³è¯·åˆ°<strong>æ ˆå†…å­˜</strong>å¥½å¤„ï¼šå‡½æ•°è¿”å›ç›´æ¥é‡Šæ”¾ï¼Œä¸ä¼šå¼•èµ·åƒåœ¾å›æ”¶ï¼Œå¯¹æ€§èƒ½æ²¡æœ‰å½±å“ã€‚</p>
<p>å†æ¥çœ‹çœ‹å †å¾—æƒ…å†µä¹‹ä¸€å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span></span> []<span class="type">int</span>&#123;</span><br><span class="line">    a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä¸Šé¢è¿™æ®µä»£ç ï¼Œç”³è¯·çš„ä»£ç ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯ç”³è¯·åä½œä¸ºè¿”å›å€¼è¿”å›äº†ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºå˜é‡ä¹‹åè¿˜ä¼šè¢«ä½¿ç”¨ï¼Œå½“å‡½æ•°è¿”å›ä¹‹åå¹¶ä¸ä¼šå°†å…¶å†…å­˜å½’è¿˜ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«ç”³è¯·åˆ° å † ä¸Šé¢äº†ã€‚</p>
<p><strong>ç”³è¯·åˆ°å †ä¸Šé¢çš„å†…å­˜æ‰ä¼šå¼•èµ·åƒåœ¾å›æ”¶ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹ï¼ˆç‰¹æŒ‡åƒåœ¾å›æ”¶ä¸æ–­è¢«è§¦å‘ï¼‰è¿‡äºé«˜é¢‘å°±ä¼šå¯¼è‡´ gc å‹åŠ›è¿‡å¤§ï¼Œç¨‹åºæ€§èƒ½å‡ºé—®é¢˜ã€‚</strong></p>
<p>æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä¸‹å‡ ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20</span>)     <span class="comment">// æ ˆ ç©ºé—´å°</span></span><br><span class="line">    b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20000</span>) <span class="comment">// å † ç©ºé—´è¿‡å¤§</span></span><br><span class="line"></span><br><span class="line">    l := <span class="number">20</span></span><br><span class="line">    c := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, l) <span class="comment">// å † åŠ¨æ€åˆ†é…ä¸å®šç©ºé—´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åƒæ˜¯ b è¿™ç§ å³ä½¿æ˜¯ä¸´æ—¶å˜é‡ï¼Œç”³è¯·è¿‡å¤§ä¹Ÿä¼šåœ¨å †ä¸Šé¢ç”³è¯·ã€‚å¯¹äº c ç¼–è¯‘å™¨å¯¹äºè¿™ç§ä¸å®šé•¿åº¦çš„ç”³è¯·æ–¹å¼ï¼Œä¹Ÿä¼šåœ¨å †ä¸Šé¢ç”³è¯·ï¼Œå³ä½¿ç”³è¯·çš„é•¿åº¦å¾ˆçŸ­ã€‚</p>
<h2 id="2-é€ƒé€¸åˆ†æï¼ˆEscape-analysisï¼‰"><a href="#2-é€ƒé€¸åˆ†æï¼ˆEscape-analysisï¼‰" class="headerlink" title="2. é€ƒé€¸åˆ†æï¼ˆEscape analysisï¼‰"></a>2. é€ƒé€¸åˆ†æï¼ˆEscape analysisï¼‰</h2><p>é€ƒé€¸åˆ†ææŒ‡çš„æ˜¯ç”±ç¼–è¯‘å™¨å†³å®šå†…å­˜åˆ†é…çš„ä½ç½®,ä¸éœ€è¦ç”±ç¨‹åºå‘˜æŒ‡å®š.</p>
<p>åœ¨å‡½æ•°ä¸­ç”³è¯·ä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<ul>
<li><p><strong>å¦‚æœç”³è¯·åˆ°æ ˆä¸­,åˆ™å‡½æ•°æ‰§è¡Œç»“æŸå¯ä»¥è‡ªåŠ¨å°†å†…å­˜å›æ”¶.</strong></p>
</li>
<li><p><strong>å¦‚æœåˆ†é…åˆ°å †,åˆ™å‡½æ•°æ‰§è¡Œç»“æŸå°±å¯ä»¥äº¤ç»™GCå¤„ç†.</strong></p>
</li>
</ul>
<h2 id="3-é€ƒé€¸åœºæ™¯ï¼ˆä»€ä¹ˆæƒ…å†µæ‰åˆ†é…åˆ°å †ä¸­ï¼‰"><a href="#3-é€ƒé€¸åœºæ™¯ï¼ˆä»€ä¹ˆæƒ…å†µæ‰åˆ†é…åˆ°å †ä¸­ï¼‰" class="headerlink" title="3. é€ƒé€¸åœºæ™¯ï¼ˆä»€ä¹ˆæƒ…å†µæ‰åˆ†é…åˆ°å †ä¸­ï¼‰"></a>3. é€ƒé€¸åœºæ™¯ï¼ˆä»€ä¹ˆæƒ…å†µæ‰åˆ†é…åˆ°å †ä¸­ï¼‰</h2><h3 id="3-1-æŒ‡é’ˆé€ƒé€¸"><a href="#3-1-æŒ‡é’ˆé€ƒé€¸" class="headerlink" title="3.1 æŒ‡é’ˆé€ƒé€¸"></a>3.1 æŒ‡é’ˆé€ƒé€¸</h3><p>Goå¯ä»¥è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå…¸å‹çš„å˜é‡é€ƒé€¸æ¡ˆä¾‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StudentRegister</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>)</span></span> *Student &#123;</span><br><span class="line">    s := <span class="built_in">new</span>(Student) <span class="comment">//å±€éƒ¨å˜é‡sé€ƒé€¸åˆ°å †</span></span><br><span class="line"></span><br><span class="line">    s.Name = name</span><br><span class="line">    s.Age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    StudentRegister(<span class="string">&quot;Jim&quot;</span>, <span class="number">18</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è™½ç„¶ åœ¨å‡½æ•° StudentRegister() å†…éƒ¨ s ä¸ºå±€éƒ¨å˜é‡ï¼Œå…¶å€¼é€šè¿‡å‡½æ•°è¿”å›å€¼è¿”å›ï¼Œs æœ¬èº«ä¸ºä¸€æŒ‡é’ˆï¼Œå…¶æŒ‡å‘çš„å†…å­˜åœ°å€ä¸ä¼šæ˜¯æ ˆè€Œæ˜¯å †ï¼Œè¿™å°±æ˜¯å…¸å‹çš„é€ƒé€¸æ¡ˆä¾‹ã€‚</p>
<p>ç»ˆç«¯è¿è¡Œå‘½ä»¤æŸ¥çœ‹é€ƒé€¸åˆ†ææ—¥å¿—ï¼š</p>
<figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -gcflags=-m</span><br></pre></td></tr></table></figure>


<img data-src="/2021/02/03/technology/golang/memory_escape/img_1.png" class="" title="image.png">

<p>å¯è§åœ¨StudentRegister()å‡½æ•°ä¸­ï¼Œä¹Ÿå³ä»£ç ç¬¬9è¡Œæ˜¾ç¤ºâ€escapes to heapâ€ï¼Œä»£è¡¨è¯¥è¡Œå†…å­˜åˆ†é…å‘ç”Ÿäº†é€ƒé€¸ç°è±¡ã€‚</p>
<h3 id="3-2-æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ï¼ˆç©ºé—´å¼€è¾Ÿè¿‡å¤§ï¼‰"><a href="#3-2-æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ï¼ˆç©ºé—´å¼€è¾Ÿè¿‡å¤§ï¼‰" class="headerlink" title="3.2 æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ï¼ˆç©ºé—´å¼€è¾Ÿè¿‡å¤§ï¼‰"></a>3.2 æ ˆç©ºé—´ä¸è¶³é€ƒé€¸ï¼ˆç©ºé—´å¼€è¾Ÿè¿‡å¤§ï¼‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Slice</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, _ := <span class="keyword">range</span> s &#123;</span><br><span class="line">        s[index] = index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Slice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ä¸Šé¢ä»£ç Slice()å‡½æ•°ä¸­åˆ†é…äº†ä¸€ä¸ª1000ä¸ªé•¿åº¦çš„åˆ‡ç‰‡ï¼Œæ˜¯å¦é€ƒé€¸å–å†³äºæ ˆç©ºé—´æ˜¯å¦è¶³å¤Ÿå¤§ã€‚ ç›´æ¥æŸ¥çœ‹ç¼–è¯‘æç¤ºï¼Œå¦‚ä¸‹ï¼š</p>
<img data-src="/2021/02/03/technology/golang/memory_escape/img_2.png" class="" title="image.png">

<p>æ‰€ä»¥åªæ˜¯1000çš„é•¿åº¦è¿˜ä¸è¶³ä»¥å‘ç”Ÿé€ƒé€¸ç°è±¡ã€‚ç„¶åå°±x10å€å§</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Slice</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">10000</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, _ := <span class="keyword">range</span> s &#123;</span><br><span class="line">        s[index] = index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Slice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†æå¦‚ä¸‹ï¼šå½“åˆ‡ç‰‡é•¿åº¦æ‰©å¤§åˆ°10000æ—¶å°±ä¼šé€ƒé€¸ã€‚å®é™…ä¸Šå½“æ ˆç©ºé—´ä¸è¶³ä»¥å­˜æ”¾å½“å‰å¯¹è±¡æ—¶æˆ–æ— æ³•åˆ¤æ–­å½“å‰åˆ‡ç‰‡é•¿åº¦æ—¶ä¼šå°†å¯¹è±¡åˆ†é…åˆ°å †ä¸­ã€‚</p>
<h3 id="3-3-åŠ¨æ€ç±»å‹é€ƒé€¸ï¼ˆä¸ç¡®å®šé•¿åº¦å¤§å°ï¼‰"><a href="#3-3-åŠ¨æ€ç±»å‹é€ƒé€¸ï¼ˆä¸ç¡®å®šé•¿åº¦å¤§å°ï¼‰" class="headerlink" title="3.3 åŠ¨æ€ç±»å‹é€ƒé€¸ï¼ˆä¸ç¡®å®šé•¿åº¦å¤§å°ï¼‰"></a>3.3 åŠ¨æ€ç±»å‹é€ƒé€¸ï¼ˆä¸ç¡®å®šé•¿åº¦å¤§å°ï¼‰</h3><p>å¾ˆå¤šå‡½æ•°å‚æ•°ä¸ºinterfaceç±»å‹ï¼Œæ¯”å¦‚fmt.Println(a â€¦interface{})ï¼Œç¼–è¯‘æœŸé—´å¾ˆéš¾ç¡®å®šå…¶å‚æ•°çš„å…·ä½“ç±»å‹ï¼Œä¹Ÿèƒ½äº§ç”Ÿé€ƒé€¸ã€‚</p>
<p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Escape&quot;</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>é€ƒé€¸åˆ†ä¸‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\SourceCode\GoExpert\src&gt;go build -gcflags=-m</span><br><span class="line"># _/D_/SourceCode/GoExpert/src</span><br><span class="line">.\main.go:7: s escapes to heap</span><br><span class="line">.\main.go:7: main ... argument does not escape</span><br></pre></td></tr></table></figure>


<p>åˆæˆ–è€…åƒå‰é¢æåˆ°çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20</span>)     <span class="comment">// æ ˆ ç©ºé—´å°</span></span><br><span class="line">    b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">20000</span>) <span class="comment">// å † ç©ºé—´è¿‡å¤§ é€ƒé€¸</span></span><br><span class="line"></span><br><span class="line">    l := <span class="number">20</span></span><br><span class="line">    c := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, l) <span class="comment">// å † åŠ¨æ€åˆ†é…ä¸å®šç©ºé—´ é€ƒé€¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-4-é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸"><a href="#3-4-é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸" class="headerlink" title="3.4 é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸"></a>3.4 é—­åŒ…å¼•ç”¨å¯¹è±¡é€ƒé€¸</h3><p>Fibonacciæ•°åˆ—çš„å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fibonacci</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        a, b = b, a+b</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f := Fibonacci()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Fibonacci: %d\n&quot;</span>, f())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> ~/go/src/gitHub/test/pool î‚° go run main.go</span><br><span class="line">Fibonacci: 1</span><br><span class="line">Fibonacci: 1</span><br><span class="line">Fibonacci: 2</span><br><span class="line">Fibonacci: 3</span><br><span class="line">Fibonacci: 5</span><br><span class="line">Fibonacci: 8</span><br><span class="line">Fibonacci: 13</span><br><span class="line">Fibonacci: 21</span><br><span class="line">Fibonacci: 34</span><br><span class="line">Fibonacci: 55</span><br></pre></td></tr></table></figure>


<p>é€ƒé€¸å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> ~/go/src/gitHub/test/pool î‚° go build -gcflags=-m</span><br><span class="line"># gitHub/test/pool</span><br><span class="line">./main.go:7:9: can inline Fibonacci.func1</span><br><span class="line">./main.go:7:9: func literal escapes to heap</span><br><span class="line">./main.go:7:9: func literal escapes to heap</span><br><span class="line">./main.go:8:10: &amp;b escapes to heap</span><br><span class="line">./main.go:6:5: moved to heap: b</span><br><span class="line">./main.go:8:13: &amp;a escapes to heap</span><br><span class="line">./main.go:6:2: moved to heap: a</span><br><span class="line">./main.go:17:34: f() escapes to heap</span><br><span class="line">./main.go:17:13: main ... argument does not escape</span><br></pre></td></tr></table></figure>


<p>Fibonacci()å‡½æ•°ä¸­åŸæœ¬å±äºå±€éƒ¨å˜é‡çš„aå’Œbç”±äºé—­åŒ…çš„å¼•ç”¨ï¼Œä¸å¾—ä¸å°†äºŒè€…æ”¾åˆ°å †ä¸Šï¼Œä»¥è‡´äº§ç”Ÿé€ƒé€¸ã€‚</p>
<h3 id="é€ƒé€¸åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#é€ƒé€¸åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="é€ƒé€¸åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>é€ƒé€¸åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h3><ol>
<li><p>é€ƒé€¸åˆ†æçš„å¥½å¤„æ˜¯ä¸ºäº†å‡å°‘gcçš„å‹åŠ›ï¼Œä¸é€ƒé€¸çš„å¯¹è±¡åˆ†é…åœ¨æ ˆä¸Šï¼Œå½“å‡½æ•°è¿”å›æ—¶å°±å›æ”¶äº†èµ„æºï¼Œä¸éœ€è¦gcæ ‡è®°æ¸…é™¤ã€‚</p>
</li>
<li><p>é€ƒé€¸åˆ†æå®Œåå¯ä»¥ç¡®å®šå“ªäº›å˜é‡å¯ä»¥åˆ†é…åœ¨æ ˆä¸Šï¼Œæ ˆçš„åˆ†é…æ¯”å †å¿«ï¼Œæ€§èƒ½å¥½(é€ƒé€¸çš„å±€éƒ¨å˜é‡ä¼šåœ¨å †ä¸Šåˆ†é… ,è€Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„åˆ™æœ‰ç¼–è¯‘å™¨åœ¨æ ˆä¸Šåˆ†é…)ã€‚</p>
</li>
<li><p>åŒæ­¥æ¶ˆé™¤ï¼Œå¦‚æœä½ å®šä¹‰çš„å¯¹è±¡çš„æ–¹æ³•ä¸Šæœ‰åŒæ­¥é”ï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œå´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ï¼Œæ­¤æ—¶é€ƒé€¸åˆ†æåçš„æœºå™¨ç ï¼Œä¼šå»æ‰åŒæ­¥é”è¿è¡Œã€‚</p>
</li>
</ol>
<h3 id="é€ƒé€¸æ€»ç»“ï¼š"><a href="#é€ƒé€¸æ€»ç»“ï¼š" class="headerlink" title="é€ƒé€¸æ€»ç»“ï¼š"></a>é€ƒé€¸æ€»ç»“ï¼š</h3><ul>
<li><p>æ ˆä¸Šåˆ†é…å†…å­˜æ¯”åœ¨å †ä¸­åˆ†é…å†…å­˜æœ‰æ›´é«˜çš„æ•ˆç‡</p>
</li>
<li><p>æ ˆä¸Šåˆ†é…çš„å†…å­˜ä¸éœ€è¦GCå¤„ç†</p>
</li>
<li><p>å †ä¸Šåˆ†é…çš„å†…å­˜ä½¿ç”¨å®Œæ¯•ä¼šäº¤ç»™GCå¤„ç†</p>
</li>
<li><p>é€ƒé€¸åˆ†æç›®çš„æ˜¯å†³å®šå†…åˆ†é…åœ°å€æ˜¯æ ˆè¿˜æ˜¯å †</p>
</li>
<li><p>é€ƒé€¸åˆ†æåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆ</p>
</li>
</ul>
<p>æé—®ï¼šå‡½æ•°ä¼ é€’æŒ‡é’ˆçœŸçš„æ¯”ä¼ å€¼æ•ˆç‡é«˜å—ï¼Ÿ</p>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“ä¼ é€’æŒ‡é’ˆå¯ä»¥å‡å°‘åº•å±‚å€¼çš„æ‹·è´ï¼Œå¯ä»¥æé«˜æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœæ‹·è´çš„æ•°æ®é‡å°ï¼Œç”±äºæŒ‡é’ˆä¼ é€’ä¼šäº§ç”Ÿé€ƒé€¸ï¼Œå¯èƒ½ä¼šä½¿ç”¨å †ï¼Œä¹Ÿå¯èƒ½ä¼šå¢åŠ GCçš„è´Ÿæ‹…ï¼Œæ‰€ä»¥ä¼ é€’æŒ‡é’ˆä¸ä¸€å®šæ˜¯é«˜æ•ˆçš„ã€‚</p>
</blockquote>
<p>åœ¨å®˜ç½‘ (golang.org) FAQ ä¸Šæœ‰ä¸€ä¸ªå…³äºå˜é‡åˆ†é…çš„é—®é¢˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>From a correctness standpoint, you donâ€™t need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.</p>
</blockquote>
<blockquote>
<p>The storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that functionâ€™s stack frame.</p>
</blockquote>
<blockquote>
<p>However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.</p>
</blockquote>
<blockquote>
<p>In the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.</p>
</blockquote>
<p>ç¿»è¯‘å¦‚ä¸‹ï¼š</p>
<p>å¦‚ä½•å¾—çŸ¥å˜é‡æ˜¯åˆ†é…åœ¨æ ˆï¼ˆstackï¼‰ä¸Šè¿˜æ˜¯å †ï¼ˆheapï¼‰ä¸Šï¼Ÿ</p>
<p>å‡†ç¡®åœ°è¯´ï¼Œä½ å¹¶ä¸éœ€è¦çŸ¥é“ã€‚Golang ä¸­çš„å˜é‡åªè¦è¢«å¼•ç”¨å°±ä¸€ç›´ä¼šå­˜æ´»ï¼Œå­˜å‚¨åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šç”±å†…éƒ¨å®ç°å†³å®šè€Œå’Œå…·ä½“çš„è¯­æ³•æ²¡æœ‰å…³ç³»ã€‚</p>
<p>çŸ¥é“å˜é‡çš„å­˜å‚¨ä½ç½®ç¡®å®å’Œæ•ˆç‡ç¼–ç¨‹æœ‰å…³ç³»ã€‚å¦‚æœå¯èƒ½ï¼ŒGolang ç¼–è¯‘å™¨ä¼šå°†å‡½æ•°çš„å±€éƒ¨å˜é‡åˆ†é…åˆ°å‡½æ•°æ ˆå¸§ï¼ˆstack frameï¼‰ä¸Šã€‚ ç„¶è€Œï¼Œå¦‚æœç¼–è¯‘å™¨ä¸èƒ½ç¡®ä¿å˜é‡åœ¨å‡½æ•° returnä¹‹åä¸å†è¢«å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°±ä¼šå°†å˜é‡åˆ†é…åˆ°å †ä¸Šã€‚è€Œä¸”ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆå®ƒä¹Ÿåº”è¯¥è¢«åˆ†é…åˆ°å †ä¸Šè€Œä¸æ˜¯æ ˆä¸Šã€‚</p>
<p>å½“å‰æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«å–åœ°å€ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰å¯èƒ½è¢«åˆ†é…åˆ°å †ä¸Šã€‚ç„¶è€Œï¼Œè¿˜è¦å¯¹è¿™äº›å˜é‡åšé€ƒé€¸åˆ†æï¼Œå¦‚æœå‡½æ•°returnä¹‹åï¼Œå˜é‡ä¸å†è¢«å¼•ç”¨ï¼Œåˆ™å°†å…¶åˆ†é…åˆ°æ ˆä¸Šã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</span>

  <div class="social-list">

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/images/wechat_channel.png">
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/" rel="tag"># åº•å±‚åŸç†</a>
              <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag"># é¢è¯•é¢˜</a>
              <a href="/tags/Golang/" rel="tag"># Golang</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/02/03/technology/golang/memory_leak/" rel="prev" title="Goå†…å­˜æ³„æ¼">
                  <i class="fa fa-angle-left"></i> Goå†…å­˜æ³„æ¼
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/02/03/technology/golang/gpm_explain/" rel="next" title="Go-GPMè§£æ">
                  Go-GPMè§£æ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zhyyao</span>
  </div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_pv"></span>
</span>
</div>

<!--
  <div class="powered-by">ç”± Zhyyao å¼ºåŠ›é©±åŠ¨
  </div>
-->

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
var options = {
  bottom: '64px', // default: '32px'
  right: 'unset', // default: '32px'
  left: '32px', // default: 'unset'
  time: '0.5s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: 'ğŸŒ“', // default: ''
  autoMatchOsTheme: true // default: true
}
const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
